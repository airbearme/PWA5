## 2024-07-16 - Content Security Policy (CSP) Implementation and Revision
**Vulnerability:** Missing Content Security Policy (CSP) header, leaving the application more vulnerable to Cross-Site Scripting (XSS) and data injection attacks.
**Learning:** The initial implementation, while well-intentioned, contained overly permissive directives (`connect-src *`, `img-src https:`) that weakened its effectiveness. A code review highlighted these weaknesses, leading to a revised policy with a much stricter scope. The `connect-src` and `img-src` directives were narrowed to only allow the application's own origin and trusted third-party services like Supabase and Vercel. This process underscored the importance of detailed, specific CSP rules over broad, permissive ones. It also revealed a current limitation with Next.js, which requires `'unsafe-inline'` for `script-src` for client-side hydration, highlighting a trade-off between security and framework compatibility that needs to be monitored.
**Prevention:** Future security reviews should not only check for the presence of a CSP but also critically evaluate the specificity of its directives. When implementing security policies, always start with the most restrictive rules possible and only open them up as strictly necessary. For framework-related security compromises, add comments to the code to explain the limitation and create a ticket to track a long-term, more secure solution (e.g., implementing a nonce-based CSP).
